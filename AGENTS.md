# AGENT OPERATIONS OVERVIEW

This file is the primary entry point for any AI agent working in this repository. Load it at the beginning of every session to understand the required protocol, project direction, and supporting documentation.

## Новая схема навигации (README + AICODE)

В этом репозитории документация для агента — это:
- `README.md` как **индекс‑карта** (пути → точки входа → команды → “как найти через rg”).
- `AICODE-*` якоря в коде/доках как **стабильные ссылки** для `rg -n "AICODE-"`.
- `docs/status.md` как **живой контекст** (текущий фокус, next steps, риски).
- `docs/decisions/*` (ADR) как **“почему так”** и принятые компромиссы.


## Обязательные документы
- `docs/aicode-anchors.md` — правила и схема AICODE-якорей (разрешённые префиксы, даты, шаблоны, namespace).
- `docs/ynab-lite-pwa-plan.md` — продуктовый план/roadmap (источник истины по scope).
- `docs/context.md` — краткий “скелет контекста” (миссия, стек, архитектурные паттерны, инварианты).
- `docs/status.md` — текущий фокус и ближайшие шаги.

## Session Boot Checklist

1) Прочитай этот `AGENTS.md`.
2) Прочитай `README.md` и используй его как карту репозитория (Repository layout / Entry points / Search cookbook).
3) Пробеги `rg -n "AICODE-"` (и при необходимости сузь по директории), чтобы найти контракты/ловушки/заметки рядом с кодом.
4) Прочитай `docs/context.md` (миссия/стек/паттерны/инварианты) и `docs/status.md` (текущий фокус/next steps/риски).
4) Прочитай `docs/ynab-lite-pwa-plan.md` (если задача продуктовая/плановая).
5) Перед любыми изменениями обязательно пробеги `rg -n "AICODE-"` и найди релевантные якоря.

## Если навигации нет или она устарела

Если в `README.md` отсутствуют секции навигации (Repository layout / Entry points / Search cookbook) или они не соответствуют текущей структуре проекта:
- обнови/создай навигацию по протоколу ниже;
- после обновления используй `README.md` + `AICODE-*` как основной интерфейс поиска.

## README как индекс (протокол)

Цель: `README.md` должен быть “оглавлением в код” — пути файлов как ссылки + команды `rg`/AICODE как быстрые переходы.

### Что должно быть в `README.md` (минимум)
1) **Repository layout**
   - 10–25 пунктов: `` `path/или/file` — назначение; искать: `AICODE-...` или `rg -n "..."` ``
   - Пункты короткие, без “эссе”.

2) **Entry points**
   - 3–10 пунктов: ключевые точки входа (Nuxt/PWA config, Dexie schema, репозитории, stores/selectors, backup/import, критические компоненты).
   - Для каждого: путь + способ найти через `rg`/`AICODE-*`.

3) **Common tasks**
   - Команды проекта (install/dev/build/preview/test/lint) — только те, что реально существуют в `package.json`/скриптах.

4) **Search cookbook**
   - 8–15 реальных команд `rg -n ...` для типовых вопросов (схема Dexie, импорт/экспорт, Zod схемы, расчёты балансов, фильтры, PWA и т.п.).

### Как обновлять индекс
- Не используй номера строк как ссылки.
- Перед добавлением новых AICODE якорей сделай `rg -n "AICODE-"` и не дублируй существующее.
- Если навигация без якорей получается “хрупкой” (рефакторинги ломают ориентиры) — добавь минимум AICODE‑якорей в стратегические места, строго по `docs/aicode-anchors.md`.

## Правила AICODE (критично)
- Якоря: только `AICODE-*` и только разрешённые префиксы из `docs/aicode-anchors.md`.
- Перед добавлением новых якорей всегда делай `rg -n "AICODE-"`, чтобы не плодить дубли.
- Для `TRAP/CONTRACT` обязательна дата `[YYYY-MM-DD]`.

## Куда писать контекст

- Навигация и “куда смотреть”: `README.md` (плюс точечные `AICODE-NOTE: NAV/...` рядом с кодом).
- Текущий фокус / next steps / риски: `docs/status.md` (коротко, списками).
- Миссия / стек / паттерны / инварианты: `docs/context.md` (редко меняется).
- “Почему так” и компромиссы: `docs/decisions/*` (ADR), с `ref:` и `AICODE-LINK:` в коде при необходимости.

## Дополнительные правила взаимодействия

- Всегда отвечайте пользователю на русском языке, даже если исходный вопрос был на другом языке.
- Всегда запускай тесты после изменений в коде.

## Минимальный “done” для любой задачи
- Обновлены релевантные `AICODE-*` якоря в затронутых местах (если были изменения поведения/контрактов).
- Если менялась структура/точки входа — обновлён `README.md` (индекс).
- Если менялся фокус/план работ — обновлён `docs/status.md` (коротко).
- Запущены проверки: `npm run lint:aicode` и `npm test` (или эквивалентные команды проекта).
